<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¤§é˜ªæ—…éŠåŠ©æ‰‹ Pro</title>
    <style>
        :root { --primary: #1A73E8; --hotel-color: #F9AB00; --bg: #f8f9fa; --danger: #EA4335; --pending: #607D8B; --share: #34A853; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); padding: 0; margin: 0; overflow-x: hidden; }
        
        /* æ§åˆ¶é¢æ¿ */
        .setup-panel { background: white; padding: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); text-align: center; position: sticky; top: 0; z-index: 100; }
        .editable-title { font-size: 20px; font-weight: bold; color: var(--primary); border: none; text-align: center; width: 100%; outline: none; margin-bottom: 10px; }

        /* åˆ†äº«åŠŸèƒ½ */
        .share-control { display: flex; gap: 8px; justify-content: center; margin-bottom: 10px; }
        .btn-share { background: var(--share); color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px; }

        /* è¡Œç¨‹å®¹å™¨ï¼šæ‰‹æ©Ÿæ”¹ç‚ºä¸Šä¸‹å †ç–Šï¼Œæ¡Œé¢ç¶­æŒæ©«å‘ */
        .itinerary-wrapper { display: flex; flex-direction: column; gap: 15px; padding: 15px; }
        @media (min-width: 768px) {
            .itinerary-wrapper { flex-direction: row; overflow-x: auto; height: calc(100vh - 200px); }
        }

        /* å¾…å®‰æ’å€ï¼šæ‰‹æ©Ÿç‰ˆå¯æ”¶åˆ */
        .pending-card { background: #eceff1; border-radius: 12px; border: 2px dashed var(--pending); flex-shrink: 0; }
        .pending-content { display: none; padding: 10px; }
        .pending-card.open .pending-content { display: block; }
        
        @media (min-width: 768px) {
            .pending-card { min-width: 280px; position: sticky; left: 0; z-index: 10; height: fit-content; }
            .pending-content { display: block; }
        }

        .day-card { min-width: 100%; background: white; border-radius: 12px; border: 1px solid #ddd; }
        @media (min-width: 768px) { .day-card { min-width: 320px; } }
        
        .header-bar { padding: 12px; color: white; border-radius: 11px 11px 0 0; font-weight: bold; text-align: center; cursor: pointer; display: flex; justify-content: center; align-items: center; gap: 10px; }
        .day-header { background: var(--primary); }
        .pending-header { background: var(--pending); }

        /* é»é¸é …ç›®èˆ‡è·¯å¾‘ */
        .spot-list { padding: 10px; min-height: 80px; }
        .spot-item { padding: 12px; border-radius: 8px; background: #fff; border: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; font-size: 14px; }
        .is-hotel { border-left: 5px solid var(--hotel-color); }
        .route-link { display: flex; align-items: center; padding: 0 0 10px 35px; text-decoration: none; color: var(--primary); font-size: 12px; position: relative; }
        .route-link::before { content: ""; position: absolute; left: 18px; top: -10px; bottom: 0; width: 2px; background: #ddd; }
        .route-btn { background: #e8f0fe; padding: 2px 8px; border-radius: 4px; }

        .add-area { padding: 10px; border-top: 1px solid #eee; display: flex; gap: 5px; }
        input, button { padding: 8px; border-radius: 6px; border: 1px solid #ddd; font-size: 14px; }
        .btn-add { background: var(--primary); color: white; border: none; }
    </style>
</head>
<body>

<div class="setup-panel">
    <input type="text" id="tripTitle" class="editable-title" value="æˆ‘çš„å¤§é˜ªä¹‹æ—…" oninput="saveData()">
    <div class="share-control">
        <button class="btn-share" onclick="exportData()">ğŸ“¤ è¤‡è£½çŸ­ç¢¼</button>
        <button class="btn-share" onclick="importData()">ğŸ“¥ åŒ¯å…¥è¡Œç¨‹</button>
    </div>
    <div style="display:flex; gap:5px; justify-content:center; flex-wrap:wrap;">
        <input type="text" id="hotelName" value="é£¯åº—" oninput="saveData()" style="width:120px;">
        <input type="date" id="startDate" value="2026-02-16" style="width:120px;">
        <button onclick="initTrip()" class="btn-add" style="padding: 4px 8px; font-size:12px;">é‡è¨­æ—¥æœŸ</button>
    </div>
</div>

<div class="itinerary-wrapper">
    <div class="pending-card" id="pendingCard">
        <div class="header-bar pending-header" onclick="togglePending()">
            ğŸ“‹ å¾…å®‰æ’æ™¯é» <span id="pendingToggleIcon">â–¼</span>
        </div>
        <div class="pending-content">
            <div class="spot-list" id="list-pending" ondragover="allowDrop(event)" ondrop="drop(event, 'pending')"></div>
            <div class="add-area">
                <input type="text" id="input-pending" placeholder="æƒ³å»å“ªï¼Ÿ" style="flex:1">
                <button class="btn-add" style="background:var(--pending)" onclick="addNewSpot('pending')">ï¼‹</button>
            </div>
        </div>
    </div>
    <div id="dailyContainer" style="display:contents;"></div>
</div>

<script>
    let tripData = { t: "æˆ‘çš„å¤§é˜ªä¹‹æ—…", h: "é£¯åº—", d: { "pending": [] } };

    window.onload = function() {
        const local = localStorage.getItem('myTripV5');
        if (local) {
            tripData = JSON.parse(local);
            document.getElementById('tripTitle').value = tripData.t;
            document.getElementById('hotelName').value = tripData.h;
            refreshUI();
        } else { initTrip(); }
    };

    function togglePending() {
        const card = document.getElementById('pendingCard');
        card.classList.toggle('open');
        document.getElementById('pendingToggleIcon').innerText = card.classList.contains('open') ? 'â–²' : 'â–¼';
    }

    function initTrip() {
        const start = new Date(document.getElementById('startDate').value);
        const oldP = tripData.d["pending"] || [];
        tripData.d = { "pending": oldP };
        for(let i=0; i<6; i++){ // é è¨­ç”¢å‡º6å¤©
            const d = new Date(start); d.setDate(start.getDate() + i);
            tripData.d[d.toISOString().split('T')[0]] = [];
        }
        saveData(); refreshUI();
    }

    function refreshUI() {
        const container = document.getElementById('dailyContainer');
        container.innerHTML = '';
        const dates = Object.keys(tripData.d).filter(x => x !== 'pending').sort();
        dates.forEach((date, i) => {
            const card = document.createElement('div');
            card.className = 'day-card';
            card.innerHTML = `<div class="header-bar day-header">Day ${i+1} - ${date}</div><div class="spot-list" id="list-${date}" ondragover="allowDrop(event)" ondrop="drop(event, '${date}')"></div><div class="add-area"><input type="text" id="input-${date}" placeholder="æ–°å¢é»..." style="flex:1"><button class="btn-add" onclick="addNewSpot('${date}')">ï¼‹</button></div>`;
            container.appendChild(card);
        });
        renderSpots();
    }

    function saveData() {
        tripData.t = document.getElementById('tripTitle').value;
        tripData.h = document.getElementById('hotelName').value;
        localStorage.setItem('myTripV5', JSON.stringify(tripData));
    }

    // åˆ†äº«ç¢¼ç¸®çŸ­é‚è¼¯ï¼šä½¿ç”¨ç°¡å¯«ä¸¦ç§»é™¤å†—é¤˜å­—å…ƒ
    function exportData() {
        const str = JSON.stringify(tripData);
        const compressed = btoa(encodeURIComponent(str)).replace(/=+$/, '');
        navigator.clipboard.writeText(compressed).then(() => alert("è¡Œç¨‹çŸ­ç¢¼å·²è¤‡è£½ï¼"));
    }

    function importData() {
        const code = prompt("è²¼ä¸Šè¡Œç¨‹ç¢¼ï¼š");
        if (code) {
            try {
                const decoded = JSON.parse(decodeURIComponent(atob(code)));
                tripData = decoded;
                saveData(); location.reload();
            } catch (e) { alert("ä»£ç¢¼éŒ¯èª¤"); }
        }
    }

    function allowDrop(e) { e.preventDefault(); }
    function drop(e, dest) {
        e.preventDefault();
        const type = e.dataTransfer.getData("type");
        if (type === "EXISTING") {
            const sD = e.dataTransfer.getData("date");
            const sI = parseInt(e.dataTransfer.getData("index"));
            const item = tripData.d[sD].splice(sI, 1)[0];
            tripData.d[dest].push(item);
        } else if (type === "TEMPLATE") {
            tripData.d[dest].push(tripData.h);
        }
        saveData(); renderSpots();
    }

    function addNewSpot(d) {
        const val = document.getElementById(`input-${d}`).value.trim();
        if (val) { tripData.d[d].push(val); document.getElementById(`input-${d}`).value = ''; saveData(); renderSpots(); }
    }

    function renderSpots() {
        for (let d in tripData.d) {
            const list = document.getElementById(`list-${d}`); if (!list) continue;
            list.innerHTML = '';
            tripData.d[d].forEach((name, i) => {
                const item = document.createElement('div');
                item.className = `spot-item ${name === tripData.h ? 'is-hotel' : ''}`;
                item.draggable = true;
                item.ondragstart = (e) => {
                    e.dataTransfer.setData("type", "EXISTING");
                    e.dataTransfer.setData("date", d);
                    e.dataTransfer.setData("index", i);
                };
                item.innerHTML = `<span>${name}</span><span style="color:red" onclick="removeSpot('${d}',${i})">âœ•</span>`;
                list.appendChild(item);
                if (d !== 'pending' && i < tripData.d[d].length - 1) {
                    const l = document.createElement('a'); l.className = 'route-link';
                    l.href = `https://www.google.com/maps/dir/?api=1&origin=${encodeURIComponent(tripData.d[d][i])}&destination=${encodeURIComponent(tripData.d[d][i+1])}&travelmode=transit`;
                    l.target = "_blank"; l.innerHTML = `<span class="route-btn">æŸ¥çœ‹è·¯å¾‘</span>`;
                    list.appendChild(l);
                }
            });
        }
    }
    function removeSpot(d, i) { tripData.d[d].splice(i, 1); saveData(); renderSpots(); }
    function dragStartTemplate(e) { e.dataTransfer.setData("type", "TEMPLATE"); }
</script>
</body>
</html>
